<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üå± ZeroByte AI</title>
  <style>
    /* General layout */
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .app {
      width: 90%;
      max-width: 800px;
      height: 90vh;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(15px);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    /* Header */
    .app-header {
      padding: 15px;
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      font-size: 18px;
    }

    .lang-toggle {
      margin-top: 10px;
    }

    .lang-toggle button {
      padding: 6px 15px;
      border: none;
      border-radius: 20px;
      margin: 0 5px;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      color: #fff;
      transition: 0.3s;
    }

    .lang-toggle button.active {
      background: #00c6ff;
      color: #000;
    }

    /* Chat area */
    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .chat-box {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      padding: 12px 16px;
      border-radius: 15px;
      max-width: 70%;
      animation: fadeIn 0.3s ease;
    }

    .message.user {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      align-self: flex-end;
      color: #fff;
    }

    .message.bot {
      background: rgba(255, 255, 255, 0.15);
      align-self: flex-start;
      color: #f1f1f1;
    }

    /* Code block */
    .code-block {
      position: relative;
    }

    .code-block pre {
      background: #1e1e1e;
      color: #dcdcdc;
      padding: 10px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 14px;
    }

    .copy-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #00c6ff;
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
    }

    /* Chat Footer */
    .chat-footer {
      display: flex;
      padding: 10px;
      background: rgba(255,255,255,0.08);
    }

    .chat-footer input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      margin-right: 10px;
      outline: none;
    }

    .chat-footer button {
      background: #00c6ff;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      font-size: 20px;
      cursor: pointer;
      color: #000;
      transition: 0.3s;
    }

    .chat-footer button:hover {
      background: #0072ff;
      color: #fff;
    }

    /* Site Footer (credit) */
    .site-footer {
      text-align: center;
      padding: 10px;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.3);
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      color: #ccc;
      font-family: monospace;
      text-shadow: 0 0 5px #00c6ff, 0 0 10px #0072ff;
      letter-spacing: 1px;
    }
    .site-footer strong {
      color: #00c6ff;
    }

    /* Animations */
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <h1>üå± ZeroByte AI</h1>
      <div class="lang-toggle">
        <button id="english-btn" class="active">English</button>
        <button id="hindi-btn">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
      </div>
    </header>

    <main class="chat-container">
      <div id="chat-box" class="chat-box"></div>
    </main>

    <footer class="chat-footer">
      <input type="text" id="user-input" placeholder="Type your message...">
      <button id="send-button">‚û§</button>
    </footer>
  </div>

  <!-- Floating Footer Credit -->
  <div class="site-footer">
    ‚ö° Made with ‚ù§Ô∏è by <strong>Harsh Singh Rao</strong>
  </div>

  <script>
    let language = "english"; // default

    const englishBtn = document.getElementById("english-btn");
    const hindiBtn = document.getElementById("hindi-btn");
    const chatBox = document.getElementById("chat-box");
    const sendBtn = document.getElementById("send-button");
    const userInput = document.getElementById("user-input");

    // Toggle language
    englishBtn.addEventListener("click", () => {
      language = "english";
      englishBtn.classList.add("active");
      hindiBtn.classList.remove("active");
    });

    hindiBtn.addEventListener("click", () => {
      language = "hindi";
      hindiBtn.classList.add("active");
      englishBtn.classList.remove("active");
    });

    // Render messages with code block + copy button
    function renderMessage(text, sender, audioUrl=null) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("message", sender);

      // Detect code blocks
      const codeRegex = /```([\s\S]*?)```/g;
      let html = text.replace(codeRegex, (match, code) => {
        const safeCode = code.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        return `
          <div class="code-block">
            <pre><code>${safeCode}</code></pre>
            <button class="copy-btn">Copy</button>
          </div>
        `;
      });

      msgDiv.innerHTML = html;

      // Add audio player
      if (audioUrl) {
        const audio = document.createElement("audio");
        audio.controls = true;
        audio.src = audioUrl;
        msgDiv.appendChild(audio);
      }

      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;

      // Enable copy buttons
      msgDiv.querySelectorAll(".copy-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const code = btn.previousElementSibling.innerText;
          navigator.clipboard.writeText(code);
          btn.innerText = "‚úî Copied";
          setTimeout(() => btn.innerText = "Copy", 1500);
        });
      });
    }

    async function sendMessage() {
      const question = userInput.value.trim();
      if (!question) return;

      renderMessage(question, "user");
      userInput.value = "";

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, language })
        });
        const data = await res.json();

        if (data.result) {
          const ans = data.result.answer || data.result.hindi_answer || "‚ö†Ô∏è No answer";
          const audioUrl = data.result.audio_url || null;
          renderMessage(ans, "bot", audioUrl);
        } else {
          renderMessage("‚ö†Ô∏è Error: " + (data.error || "Unknown"), "bot");
        }
      } catch (err) {
        renderMessage("‚ö†Ô∏è Failed to reach server: " + err, "bot");
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });
  </script>
</body>
</html>
